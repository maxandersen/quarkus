ifdef::context[:parent-context: {context}]
[id="create-a-quarkus-application-with-a-secret-configuration_{context}"]
= Create a quarkus application with a secret configuration
:context: create-a-quarkus-application-with-a-secret-configuration

[source,shell,subs="attributes+"]
----
mvn io.quarkus:quarkus-maven-plugin:{quarkus-version}:create \
    -DprojectGroupId=org.acme \
    -DprojectArtifactId=vault-quickstart \
    -DclassName="org.acme.quickstart.GreetingResource" \
    -Dpath="/hello" \
    -Dextensions="vault,hibernate-orm,jdbc-postgresql"
cd vault-quickstart
----

Configure access to vault from the `{config-file}`:

[source,properties]
----
# vault url
quarkus.vault.url=http://localhost:8200

# vault authentication
quarkus.vault.authentication.userpass.username=bob
quarkus.vault.authentication.userpass.password=sinclair

# path within the kv secret engine where is located the vault-quickstart secret configuration
quarkus.vault.secret-config-kv-path=myapps/vault-quickstart/config
----

This should mount whatever keys are stored in `secret/myapps/vault-quickstart` as MicroProfile config properties.

Let's verify that by adding a new endpoint in GreetingResource:

[source,java]
----
@Path("/hello")
public class GreetingResource {

    @ConfigProperty(name = "a-private-key")
    String privateKey;

    ...

    @GET
    @Path("/private-key")
    @Produces(MediaType.TEXT_PLAIN)
    public String privateKey() {
        return privateKey;
    }
}
----

Now compile the application and run it:

[source,shell]
----
./mvnw clean install
java -jar target/vault-quickstart-1.0-SNAPSHOT-runner.jar
----

Finally test the new endpoint:

[source,shell]
----
curl http://localhost:8080/hello/private-key
----

You should see:

[source,shell]
----
123456
----


ifdef::parent-context[:context: {parent-context}]
ifndef::parent-context[:!context:]